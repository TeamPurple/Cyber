<!DOCTYPE html>
<html>
  <head>
    <title>Team Purple</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/app.css" rel="stylesheet">
    <link href="/static/css/nv.d3.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">

      <div class="starter-template widget">
        <h1>Results for {{ phone_number }}</h1>
        <h2>Last active on WhatsApp at {{ last_time }}</h2>
      </div>
	  <form class="form-inline" role="form" action="" method="post">
	  <div class="form-group">
	    <label class="sr-only" for="phone_number">Phone number</label>
	    <input type="text" class="form-control" name="phone_number" placeholder="Enter phone number">
	  </div>
	  <button type="submit" class="btn btn-default">Search</button>
	  </form>
	  <div id="chart">
	    <svg></svg>
	  </div>
    </div><!-- /.container -->

	<div class="container widget">
	  <div class="row">
	    <div class="col-xs-12"><img src="{{ photo_path }}"></div>
      </div>
	</div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/static/js/bootstrap.min.js"></script>
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="/static/js/nv.d3.js"></script>
	<script>
	var testData = function() {
	  var fakeData = [
	    {x: 1388430283171, y: 1},
	    {x: 1388430283171 + 5000, y: 0},
	    {x: 1388430292915, y: 1},
	    {x: 1388430292915 + 5000, y: 0},
	  ];
 
	  return [
	    {
	      values: fakeData,
	      key: 'Online Status',
	      color: '#ff7f0e'
	    }
	  ];
	};

	// data is an array of integers, each of which corresponds to the "last 
	// signed out" time of the user. returns an array of objects for each
	// point in the graph of the format {x: 1388430283171, y: 1}, where x is
	// the timestamp and y is 1 if the user is signed in and 0 otherwise. 
	var formatData = function(data) {
	    var dataPoints = [];
		$.each( data, function( key, xValue ) {
			console.log(xValue);
		    dataPoints.push({x: xValue + 1, y: 0});
		    dataPoints.push({x: xValue, y: 1});
		    dataPoints.push({x: xValue - 60 * 1000, y: 1});
		    dataPoints.push({x: xValue - 60 * 1000 - 1, y: 0});
		});
		console.log(dataPoints);
		return [
	      {
	        values: dataPoints,
	        key: 'Online Status',
	        color: '#ff7f0e'
	      }
	    ];
	}
	
	var createTimeline = function(data) {

		// initialize graph itself
		nv.addGraph(function() {
		  var chart = nv.models.lineChart();
 
		  chart.xAxis.axisLabel('Time')
		    .tickFormat(function(d) {
		  return d3.time.format('%I:%m %p')(new Date(d))
		      });
 
		  chart.yAxis
		      .axisLabel('Online Status')
		      .tickFormat(d3.format('.02f'));
 
		  d3.select('#chart svg')
		      .datum(data)
		    .transition().duration(500)
		      .call(chart);
 
		  nv.utils.windowResize(chart.update);
 
		  return chart;
		})};

  	//createTimeline(testData);
  	createTimeline(formatData([1388430283171, 1388430292915]));
	
	// TODO(dina): uncomment this when flask endpoint exists.
//  $.getJSON( "/timeline&phone=" + {{ phone_number }}, function( data ) {
// 	  createTimeline(data);
// 	});
	</script>
	<style>
	  #chart svg {
	    height: 400px;
	  }
	</style>
 
	
  </body>
</html>

